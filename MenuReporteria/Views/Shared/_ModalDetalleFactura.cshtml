@model MenuReporteria.Models.DetalleFacturaViewModel

<!-- Contenido del modal (sin el wrapper .modal-factura porque ya existe en el DOM) -->
<div class="modal-factura-content">
    <!-- Header -->
    <div class="modal-header">
        <h2>📄 Detalle de Factura #@(Model?.Factura ?? "---")</h2>
        <button class="modal-close" onclick="cerrarModalFactura()">×</button>
    </div>

    <!-- Body -->
    <div class="modal-body">

            <!-- Información General -->
            <div class="factura-section">
                <div class="factura-section-title">
                    ℹ️ Información General
                </div>
                <div class="factura-grid">
                    <div class="factura-field">
                        <label>Número de Factura</label>
                        <div class="factura-field-value" id="detalle-factura">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Fecha</label>
                        <div class="factura-field-value" id="detalle-fecha">-</div>
                    </div>
                    <div class="factura-field">
                        <label>NCF</label>
                        <div class="factura-field-value" id="detalle-ncf">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Usuario</label>
                        <div class="factura-field-value" id="detalle-usuario">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Turno</label>
                        <div class="factura-field-value" id="detalle-turno">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Último Control</label>
                        <div class="factura-field-value" id="detalle-control">-</div>
                    </div>
                </div>
            </div>

            <!-- Información del Cliente -->
            <div class="factura-section">
                <div class="factura-section-title">
                    👤 Información del Cliente
                </div>
                <div class="factura-grid">
                    <div class="factura-field">
                        <label>Número de Cliente</label>
                        <div class="factura-field-value" id="detalle-cliente-codigo">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Nombre</label>
                        <div class="factura-field-value" id="detalle-cliente-nombre">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Dirección</label>
                        <div class="factura-field-value" id="detalle-cliente-direccion">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Teléfono</label>
                        <div class="factura-field-value" id="detalle-cliente-telefono">-</div>
                    </div>
                </div>
            </div>

            <!-- Datos de Chasis -->
            <div class="factura-section">
                <div class="factura-section-title">
                    🚗 Datos del Chasis
                </div>
                <div class="factura-grid">
                    <div class="factura-field">
                        <label>Chasis</label>
                        <div class="factura-field-value" id="detalle-chasis">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Año</label>
                        <div class="factura-field-value" id="detalle-ano">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Motor</label>
                        <div class="factura-field-value" id="detalle-motor">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Modelo</label>
                        <div class="factura-field-value" id="detalle-modelo">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Color</label>
                        <div class="factura-field-value" id="detalle-color">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Placa</label>
                        <div class="factura-field-value" id="detalle-placa">-</div>
                    </div>
                    <div class="factura-field">
                        <label>Matrícula</label>
                        <div class="factura-field-value" id="detalle-matricula">-</div>
                    </div>
                </div>
            </div>

            <!-- Tabla de Productos -->
            <div class="factura-section">
                <div class="factura-section-title">
                    📦 Productos/Servicios
                </div>
                <table class="productos-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Cod. Ficha</th>
                            <th>Cantidad</th>
                            <th>UM</th>
                            <th>Descripción</th>
                            <th class="text-right">Precio Unit.</th>
                            <th class="text-right">ITBIS</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody id="productos-tbody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #95a5a6;">
                                Cargando productos...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Totales -->
            <div class="factura-totales">
                <div class="factura-totales-grid">
                    <div class="total-item">
                        <label>Impuesto 17%</label>
                        <div class="total-item-value" id="detalle-impuesto17">RD$ 0.00</div>
                    </div>
                    <div class="total-item">
                        <label>Itbis 18%</label>
                        <div class="total-item-value" id="detalle-itbis18">RD$ 0.00</div>
                    </div>
                    <div class="total-item">
                        <label>Descuento</label>
                        <div class="total-item-value" id="detalle-descuento">RD$ 0.00</div>
                    </div>
                    <div class="total-item">
                        <label>Sub-Total</label>
                        <div class="total-item-value" id="detalle-subtotal">RD$ 0.00</div>
                    </div>
                    <div class="total-item">
                        <label>Total Itbis</label>
                        <div class="total-item-value" id="detalle-total-itbis">RD$ 0.00</div>
                    </div>
                    <div class="total-item" style="background: rgba(255, 255, 255, 0.3);">
                        <label>Monto Neto</label>
                        <div class="total-item-value" id="detalle-monto-neto" style="font-size: 22px;">RD$ 0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
            <button class="btn-modal btn-modal-primary" onclick="imprimirFactura()">
                🖨️ Imprimir
            </button>
            <button class="btn-modal btn-modal-secondary" onclick="cerrarModalFactura()">
                Cerrar
            </button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function abrirModalFactura(facturaNumero) {
        const modal = document.getElementById('modalFactura');
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Aquí cargarías los datos de la factura
        // Por ahora solo mostramos el número
        document.getElementById('detalle-factura').textContent = facturaNumero;

        // Simular carga de datos (luego se conectará al backend)
        cargarDetalleFactura(facturaNumero);
    }

    function cerrarModalFactura() {
        const modal = document.getElementById('modalFactura');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    function cargarDetalleFactura(facturaNumero) {
        // Esta función se conectará al backend para obtener los datos
        // Por ahora muestra datos de ejemplo
        console.log('Cargando factura:', facturaNumero);

        // Ejemplo de cómo se cargarían los productos
        const productosEjemplo = `
            <tr>
                <td>1</td>
                <td>LZRKTF00BS1010183</td>
                <td>1.00</td>
                <td>UD</td>
                <td>TAURO LEAD 125 BLANCO 2025</td>
                <td class="text-right">1090.00</td>
                <td class="text-right">152.20</td>
                <td class="text-right">1,090.00</td>
            </tr>
        `;

        // Descomentar cuando tengas datos reales
        // document.getElementById('productos-tbody').innerHTML = productosEjemplo;
    }

    function imprimirFactura() {
        window.print();
    }

    // Cerrar modal al hacer clic fuera
    window.onclick = function(event) {
        const modal = document.getElementById('modalFactura');
        if (event.target === modal) {
            cerrarModalFactura();
        }
    }

    // Cerrar modal con tecla ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            cerrarModalFactura();
        }
    });
</script>